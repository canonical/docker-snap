summary: Test run a container with --init option


manual: true # ** NOTE: This test is disabled for now **
execute: |
    # TODO: Investigate why this is failing
    # run container in the background
    id=$(sudo docker run -dit ubuntu bash)

    # check the pid
    pid=$(sudo docker exec -t $id ps auxf | grep bash | awk '{print $2}')
    [ $pid = 1 ] || exit 1
    
    # stop the contianer
    sudo docker stop $id

    # remove the container 
    sudo docker rm -f $id

    # run container with --init option 
    id=$(sudo docker run -dit --init ubuntu bash)
    
    # Test the current output
    echo "$(sudo docker exec -t $id ps auxf)"

    # check the pid
    pid=$(sudo docker exec -t $id ps auxf | grep '[t]init' | awk '{print $2}')

    # Ensure PID is not empty
    [ -n "$pid" ] || exit 1
    [ "$pid" = "1" ] || exit 1

    # stop the contianer
    sudo docker stop $id

    # remove the container 
    sudo docker rm -f $id

